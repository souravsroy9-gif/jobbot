<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobBot Pro - Live Agartala Jobs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Poppins', sans-serif; }
        body { background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #0f0f23 100%); min-height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glow-pulse { animation: glowPulse 2s infinite; }
        @keyframes glowPulse { 0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); } 50% { box-shadow: 0 0 40px rgba(16, 185, 129, 0.5); } }
        .gradient-text { background: linear-gradient(90deg, #10b981, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .scroll-hidden::-webkit-scrollbar { display: none; }
        .tab-btn.active { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(6, 182, 212, 0.2)); border-color: rgba(16, 185, 129, 0.5); color: #10b981; }
        .job-card { transition: all 0.3s ease; }
        .job-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(16, 185, 129, 0.15); }
        .job-card.new-job { animation: newJobAnim 0.5s ease; border-color: rgba(16, 185, 129, 0.5); }
        @keyframes newJobAnim { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .btn-primary { background: linear-gradient(135deg, #10b981, #059669); }
        .btn-telegram { background: linear-gradient(135deg, #0088cc, #0077b5); }
        .btn-refresh { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
        input:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2); }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .loader { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #10b981; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .notification-badge { animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .refresh-spin { animation: spin 1s linear infinite; }
        .live-dot { animation: liveDot 1.5s infinite; }
        @keyframes liveDot { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body class="text-white">
    <!-- Notification Banner -->
    <div id="notificationBanner" class="hidden fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-emerald-600 to-cyan-600 p-3 text-center text-sm">
        <span>ğŸ”” Enable notifications for new job alerts!</span>
        <button onclick="enableNotifications()" class="ml-3 bg-white text-emerald-600 px-3 py-1 rounded-lg text-xs font-semibold">Enable</button>
        <button onclick="this.parentElement.classList.add('hidden')" class="ml-2 text-white/80 hover:text-white">âœ•</button>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-40 glass">
        <div class="max-w-5xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center glow-pulse">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold gradient-text">JobBot Pro</h1>
                        <p class="text-xs text-slate-400 flex items-center gap-1">
                            <span class="w-2 h-2 bg-emerald-400 rounded-full live-dot"></span> Live â€¢ Agartala Jobs
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span id="lastUpdate" class="text-xs text-slate-500 hidden sm:block"></span>
                    <span id="newJobsBadge" class="hidden bg-red-500 text-white text-xs px-2 py-0.5 rounded-full notification-badge">0 new</span>
                    <span id="jobCounter" class="text-xs bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-full border border-emerald-500/30 font-medium">Loading...</span>
                    <button onclick="refreshJobs()" id="refreshBtn" class="p-2.5 glass rounded-xl hover:bg-white/10" title="Refresh">
                        <svg id="refreshIcon" class="w-5 h-5 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                    </button>
                    <button onclick="openSettings()" class="p-2.5 glass rounded-xl hover:bg-white/10">âš™ï¸</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Auto-Update Status -->
    <div class="max-w-5xl mx-auto px-4 py-2">
        <div class="flex items-center justify-between text-xs text-slate-500">
            <span id="autoUpdateStatus" class="flex items-center gap-1"><span class="w-2 h-2 bg-emerald-400 rounded-full live-dot"></span> Auto-update: ON</span>
            <div class="flex items-center gap-3">
                <span id="nextUpdateTime">Next: 5:00</span>
                <button onclick="toggleAutoUpdate()" id="toggleAutoBtn" class="text-emerald-400 hover:text-emerald-300">Pause</button>
            </div>
        </div>
    </div>

    <!-- Search -->
    <div class="max-w-5xl mx-auto px-4 py-2">
        <div class="glass rounded-2xl p-4 mb-4">
            <div class="flex gap-2">
                <input id="searchInput" type="text" placeholder="Search all Agartala jobs..." class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-slate-500" onkeypress="if(event.key==='Enter')searchJobs()">
                <button onclick="searchJobs()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">ğŸ”</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex gap-2 overflow-x-auto scroll-hidden pb-3 mb-4">
            <button onclick="filterCategory('all',this)" class="tab-btn active px-4 py-2 rounded-xl border border-white/10 text-sm font-medium whitespace-nowrap glass">ğŸ“‹ All</button>
            <button onclick="filterCategory('government',this)" class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-medium whitespace-nowrap glass hover:bg-white/5">ğŸ›ï¸ Government</button>
            <button onclick="filterCategory('bank',this)" class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-medium whitespace-nowrap glass hover:bg-white/5">ğŸ¦ Bank</button>
            <button onclick="filterCategory('private',this)" class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-medium whitespace-nowrap glass hover:bg-white/5">ğŸ¢ Private</button>
            <button onclick="filterCategory('fresher',this)" class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-medium whitespace-nowrap glass hover:bg-white/5">ğŸ“ Freshers</button>
            <button onclick="filterCategory('saved',this)" class="tab-btn px-4 py-2 rounded-xl border border-white/10 text-sm font-medium whitespace-nowrap glass hover:bg-white/5">â­ Saved</button>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-2 sm:grid-cols-5 gap-3 mb-4">
            <div class="glass rounded-xl p-3 text-center"><p class="text-xl font-bold" id="statTotal">0</p><p class="text-xs text-slate-400">Total</p></div>
            <div class="glass rounded-xl p-3 text-center"><p class="text-xl font-bold text-emerald-400" id="statNew">0</p><p class="text-xs text-slate-400">New</p></div>
            <div class="glass rounded-xl p-3 text-center"><p class="text-xl font-bold text-yellow-400" id="statSaved">0</p><p class="text-xs text-slate-400">Saved</p></div>
            <div class="glass rounded-xl p-3 text-center"><p class="text-xl font-bold text-cyan-400" id="statMatch">0</p><p class="text-xs text-slate-400">Best Match</p></div>
            <div class="glass rounded-xl p-3 text-center col-span-2 sm:col-span-1"><p class="text-xl font-bold text-purple-400" id="statApplied">0</p><p class="text-xs text-slate-400">Applied</p></div>
        </div>

        <!-- Loading -->
        <div id="loadingState" class="flex flex-col items-center py-16"><div class="loader mb-4"></div><p class="text-slate-400 text-sm" id="loadingText">Fetching jobs...</p></div>

        <!-- Empty -->
        <div id="emptyState" class="hidden flex flex-col items-center py-16"><div class="text-6xl mb-4">ğŸ”</div><h3 class="text-xl font-semibold mb-2">No Jobs Found</h3><button onclick="refreshJobs()" class="btn-primary text-white px-6 py-2 rounded-xl mt-2">ğŸ”„ Refresh</button></div>

        <!-- Jobs List -->
        <div id="jobsList" class="hidden space-y-3"></div>
    </div>

    <!-- Job Modal -->
    <div id="jobModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/70" onclick="closeJobModal()"></div>
        <div class="absolute right-0 top-0 bottom-0 w-full max-w-lg bg-slate-900 border-l border-white/10 overflow-y-auto slide-in">
            <div id="jobModalContent" class="p-6"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/70" onclick="closeSettings()"></div>
        <div class="absolute right-0 top-0 bottom-0 w-full max-w-md bg-slate-900 border-l border-white/10 overflow-y-auto slide-in">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6"><h2 class="text-xl font-bold">âš™ï¸ Settings</h2><button onclick="closeSettings()" class="p-2 glass rounded-lg">âœ•</button></div>
                
                <!-- Auto-Update -->
                <div class="mb-6">
                    <h3 class="text-sm font-semibold text-slate-400 uppercase mb-3">ğŸ”„ Auto-Update</h3>
                    <div class="glass rounded-xl p-4 space-y-3">
                        <div class="flex items-center justify-between"><span class="text-sm">Enable Auto-Update</span><button onclick="toggleAutoUpdate()" id="autoUpdateToggle" class="w-12 h-6 bg-emerald-500 rounded-full relative"><span class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full"></span></button></div>
                        <div><label class="text-sm text-slate-300">Update Interval</label><select id="updateInterval" class="w-full mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-white" onchange="saveUpdateInterval()"><option value="1">Every 1 minute</option><option value="5" selected>Every 5 minutes</option><option value="10">Every 10 minutes</option><option value="30">Every 30 minutes</option></select></div>
                        <div class="flex items-center justify-between"><span class="text-sm">Browser Notifications</span><button onclick="enableNotifications()" id="notifToggle" class="text-xs bg-slate-700 px-3 py-1 rounded-full">Enable</button></div>
                    </div>
                </div>

                <!-- Profile -->
                <div class="mb-6">
                    <h3 class="text-sm font-semibold text-slate-400 uppercase mb-3">ğŸ‘¤ Profile</h3>
                    <div class="space-y-3">
                        <input id="settingsName" type="text" placeholder="Full Name" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-white">
                        <input id="settingsEmail" type="email" placeholder="Email" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-white">
                        <input id="settingsPhone" type="tel" placeholder="Phone (+91 XXXXX XXXXX)" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-white">
                    </div>
                </div>
                
                <!-- Preferences -->
                <div class="mb-6">
                    <h3 class="text-sm font-semibold text-slate-400 uppercase mb-3">ğŸ¯ Preferences</h3>
                    <div class="space-y-3">
                        <input id="settingsJobTitle" type="text" placeholder="Job Title" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-white">
                        <input id="settingsSkills" type="text" placeholder="Skills (comma separated)" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-white">
                    </div>
                </div>
                
                <!-- Telegram -->
                <div class="mb-6">
                    <h3 class="text-sm font-semibold text-slate-400 uppercase mb-3">ğŸ“± Telegram</h3>
                    <div class="glass rounded-xl p-3 mb-3 text-xs text-slate-300"><p class="text-cyan-400 font-medium mb-1">Setup:</p><ol class="list-decimal list-inside"><li>@BotFather â†’ /newbot â†’ Get Token</li><li>@userinfobot â†’ Get Chat ID</li></ol></div>
                    <div class="space-y-3">
                        <input id="settingsTelegramToken" type="password" placeholder="Bot Token" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-white">
                        <input id="settingsTelegramChatId" type="text" placeholder="Chat ID" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-white">
                        <button onclick="testTelegram()" class="w-full btn-telegram text-white py-2.5 rounded-xl font-medium">ğŸ“¨ Test Telegram</button>
                    </div>
                </div>
                
                <button onclick="saveSettings()" class="w-full btn-primary text-white py-3 rounded-xl font-semibold">ğŸ’¾ Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Toasts -->
    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 hidden"><div class="glass px-5 py-3 rounded-xl"><p id="toastMessage" class="text-sm"></p></div></div>
    <div id="newJobToast" class="fixed top-20 left-1/2 -translate-x-1/2 z-50 hidden"><div class="bg-gradient-to-r from-emerald-600 to-cyan-600 px-5 py-3 rounded-xl flex items-center gap-3"><span class="text-2xl">ğŸ‰</span><div><p class="text-sm font-semibold">New Jobs Found!</p><p class="text-xs opacity-90" id="newJobToastCount">0 new</p></div><button onclick="document.getElementById('newJobToast').classList.add('hidden')" class="ml-2">âœ•</button></div></div>

    <script>
        const API_KEY = 'c50d199070mshd1ec6fc4eb809a6p106fbcjsn03dc25c06455';
        let allJobs = [], previousJobCount = 0, currentCategory = 'all';
        let savedJobs = JSON.parse(localStorage.getItem('jobbot_saved')) || [];
        let appliedJobs = JSON.parse(localStorage.getItem('jobbot_applied')) || [];
        let userProfile = JSON.parse(localStorage.getItem('jobbot_profile')) || {};
        let settings = JSON.parse(localStorage.getItem('jobbot_settings')) || { autoUpdate: true, interval: 5 };
        let autoUpdateTimer = null, countdownTimer = null, nextUpdateSeconds = 0;

        const localJobs = [
            {id:'g1',title:'Office Assistant',company:'Tripura Secretariat',location:'Agartala',salary:'â‚¹21,700-69,100',category:'government',description:'Office Assistant at Tripura Secretariat.',requirements:['12th Pass','Computer'],posted:'Today',deadline:'15 days',url:'https://tripura.gov.in',match:88,isNew:true},
            {id:'g2',title:'Clerk cum Computer Operator',company:'District Court Agartala',location:'Agartala',salary:'â‚¹19,900-63,200',category:'government',description:'Clerk at District Court.',requirements:['Graduate','Computer'],posted:'2 days ago',deadline:'20 days',url:'https://districts.ecourts.gov.in/tripura',match:92,isNew:true},
            {id:'g3',title:'Data Entry Operator',company:'Tribal Welfare Dept',location:'Agartala',salary:'â‚¹18,000-25,000',category:'government',description:'Data Entry for govt schemes.',requirements:['12th','Typing 35 WPM'],posted:'1 day ago',deadline:'10 days',url:'#',match:85,isNew:true},
            {id:'g4',title:'Junior Assistant',company:'BSNL Agartala',location:'Agartala',salary:'â‚¹21,700-69,100',category:'government',description:'Junior Assistant at BSNL.',requirements:['12th','Computer'],posted:'1 week ago',deadline:'30 days',url:'https://bsnl.co.in',match:82},
            {id:'g5',title:'LDC',company:'Income Tax Dept',location:'Agartala',salary:'â‚¹19,900-63,200',category:'government',description:'Lower Division Clerk.',requirements:['12th','Typing'],posted:'3 days ago',deadline:'21 days',url:'#',match:84},
            {id:'g6',title:'Forest Guard',company:'Tripura Forest Dept',location:'Agartala',salary:'â‚¹21,700-69,100',category:'government',description:'Forest Guard position.',requirements:['12th','Physical Fitness'],posted:'2 days ago',deadline:'30 days',url:'#',match:72},
            {id:'b1',title:'Back Office Executive',company:'Tripura Co-op Bank',location:'Agartala',salary:'â‚¹22,000-35,000',category:'bank',description:'Back Office at Co-op Bank.',requirements:['Graduate','Computer'],posted:'3 days ago',deadline:'25 days',url:'https://tscbank.in',match:95,isNew:true},
            {id:'b2',title:'Computer Operator',company:'State Bank of India',location:'Agartala',salary:'â‚¹20,000-32,000',category:'bank',description:'Computer Operator at SBI.',requirements:['Graduate','Computer'],posted:'2 days ago',deadline:'14 days',url:'https://sbi.co.in',match:88,isNew:true},
            {id:'b3',title:'Clerk',company:'Union Bank',location:'Agartala',salary:'â‚¹19,900-63,200',category:'bank',description:'Clerk at Union Bank.',requirements:['Graduate'],posted:'4 days ago',deadline:'30 days',url:'#',match:86},
            {id:'b4',title:'Office Assistant',company:'Tripura Gramin Bank',location:'Agartala',salary:'â‚¹18,000-28,000',category:'bank',description:'Office Assistant.',requirements:['12th','Computer'],posted:'3 days ago',deadline:'22 days',url:'#',match:89},
            {id:'b5',title:'Data Entry',company:'ICICI Bank',location:'Agartala',salary:'â‚¹18,000-26,000',category:'bank',description:'Data Entry at ICICI.',requirements:['Graduate','Typing'],posted:'1 day ago',deadline:'15 days',url:'#',match:87,isNew:true},
            {id:'p1',title:'Back Office',company:'Reliance Retail',location:'Agartala',salary:'â‚¹15,000-22,000',category:'private',description:'Back Office at Reliance.',requirements:['12th','Computer'],posted:'2 days ago',deadline:'Apply Soon',url:'#',match:85,isNew:true},
            {id:'p2',title:'Sales Executive',company:'Maruti Suzuki',location:'Agartala',salary:'â‚¹18,000-30,000',category:'private',description:'Sales at Maruti.',requirements:['12th','Communication'],posted:'3 days ago',deadline:'Apply Soon',url:'#',match:75},
            {id:'p3',title:'Computer Operator',company:'IT Company',location:'Agartala',salary:'â‚¹12,000-20,000',category:'private',description:'Computer Operator.',requirements:['12th','MS Office'],posted:'1 day ago',deadline:'Apply Soon',url:'#',match:82,isNew:true},
            {id:'p4',title:'Receptionist',company:'Hotel Royal Plaza',location:'Agartala',salary:'â‚¹15,000-22,000',category:'private',description:'Receptionist at Hotel.',requirements:['12th','Communication'],posted:'2 days ago',deadline:'Apply Soon',url:'#',match:78},
            {id:'p5',title:'Accountant',company:'CA Firm',location:'Agartala',salary:'â‚¹18,000-30,000',category:'private',description:'Accountant at CA Firm.',requirements:['B.Com','Tally'],posted:'1 week ago',deadline:'Apply Soon',url:'#',match:83},
            {id:'p6',title:'Tally Operator',company:'Trading Co',location:'Agartala',salary:'â‚¹15,000-22,000',category:'private',description:'Tally Operator.',requirements:['12th','Tally'],posted:'3 days ago',deadline:'Apply Soon',url:'#',match:86},
            {id:'f1',title:'Fresher - Back Office',company:'ICICI Bank',location:'Agartala',salary:'â‚¹18,000-25,000',category:'fresher',description:'Fresher opening at ICICI.',requirements:['Graduate','Fresher'],posted:'1 day ago',deadline:'7 days',url:'#',match:90,isNew:true},
            {id:'f2',title:'Trainee Data Entry',company:'MNC',location:'Agartala',salary:'â‚¹12,000-18,000',category:'fresher',description:'Trainee Data Entry.',requirements:['12th','Typing'],posted:'2 days ago',deadline:'10 days',url:'#',match:88,isNew:true},
            {id:'f3',title:'Customer Care',company:'Airtel',location:'Agartala',salary:'â‚¹14,000-20,000',category:'fresher',description:'Customer Care at Airtel.',requirements:['12th','Communication'],posted:'4 days ago',deadline:'15 days',url:'#',match:76},
            {id:'f4',title:'Marketing Executive',company:'Insurance Co',location:'Agartala',salary:'â‚¹15,000-25,000',category:'fresher',description:'Marketing for Insurance.',requirements:['12th','Bike'],posted:'1 week ago',deadline:'20 days',url:'#',match:72}
        ];

        const searchQueries = ['jobs Agartala Tripura','government jobs Tripura','bank jobs Agartala','clerk jobs Agartala','data entry Agartala','back office Agartala','office assistant Tripura','freshers jobs Agartala','private jobs Agartala','computer operator Agartala'];

        document.addEventListener('DOMContentLoaded', () => { loadSettingsToForm(); loadSavedSettings(); searchJobs(); setupAutoUpdate(); checkNotificationPermission(); });

        function setupAutoUpdate() { if (settings.autoUpdate) startAutoUpdate(); updateAutoUpdateUI(); }
        function startAutoUpdate() { stopAutoUpdate(); const intervalMs = (settings.interval || 5) * 60 * 1000; nextUpdateSeconds = settings.interval * 60; autoUpdateTimer = setInterval(() => refreshJobs(true), intervalMs); countdownTimer = setInterval(() => { nextUpdateSeconds--; if (nextUpdateSeconds <= 0) nextUpdateSeconds = settings.interval * 60; updateCountdownDisplay(); }, 1000); updateCountdownDisplay(); }
        function stopAutoUpdate() { if (autoUpdateTimer) clearInterval(autoUpdateTimer); if (countdownTimer) clearInterval(countdownTimer); }
        function toggleAutoUpdate() { settings.autoUpdate = !settings.autoUpdate; localStorage.setItem('jobbot_settings', JSON.stringify(settings)); if (settings.autoUpdate) { startAutoUpdate(); showToast('Auto-update ON'); } else { stopAutoUpdate(); showToast('Auto-update OFF'); } updateAutoUpdateUI(); }
        function updateAutoUpdateUI() { const s = document.getElementById('autoUpdateStatus'), b = document.getElementById('toggleAutoBtn'), t = document.getElementById('autoUpdateToggle'); if (settings.autoUpdate) { s.innerHTML = '<span class="w-2 h-2 bg-emerald-400 rounded-full live-dot"></span> Auto-update: ON'; b.textContent = 'Pause'; t.classList.add('bg-emerald-500'); } else { s.innerHTML = '<span class="w-2 h-2 bg-slate-400 rounded-full"></span> Auto-update: OFF'; b.textContent = 'Resume'; t.classList.remove('bg-emerald-500'); t.classList.add('bg-slate-600'); } }
        function updateCountdownDisplay() { const m = Math.floor(nextUpdateSeconds / 60), s = nextUpdateSeconds % 60; document.getElementById('nextUpdateTime').textContent = `Next: ${m}:${s.toString().padStart(2,'0')}`; }
        function saveUpdateInterval() { settings.interval = parseInt(document.getElementById('updateInterval').value); localStorage.setItem('jobbot_settings', JSON.stringify(settings)); if (settings.autoUpdate) startAutoUpdate(); showToast('Saved'); }

        function checkNotificationPermission() { if ('Notification' in window && Notification.permission === 'default') document.getElementById('notificationBanner').classList.remove('hidden'); updateNotificationButton(); }
        function updateNotificationButton() { const b = document.getElementById('notifToggle'); if (Notification.permission === 'granted') { b.textContent = 'Enabled âœ“'; b.classList.add('bg-emerald-500/20'); } else { b.textContent = 'Enable'; b.classList.remove('bg-emerald-500/20'); } }
        async function enableNotifications() { if ('Notification' in window) { const p = await Notification.requestPermission(); if (p === 'granted') { showToast('Notifications ON'); new Notification('JobBot Pro', { body: 'You will get new job alerts!' }); } updateNotificationButton(); } document.getElementById('notificationBanner').classList.add('hidden'); }
        function sendNewJobsNotification(c) { if (Notification.permission === 'granted') new Notification('ğŸ‰ New Jobs!', { body: `${c} new jobs in Agartala!`, tag: 'new-jobs' }); }

        async function refreshJobs(isAuto = false) { document.getElementById('refreshIcon').classList.add('refresh-spin'); previousJobCount = allJobs.length; await searchJobs(isAuto); document.getElementById('refreshIcon').classList.remove('refresh-spin'); }

        async function searchJobs(isAuto = false) {
            if (!isAuto) { document.getElementById('loadingState').classList.remove('hidden'); document.getElementById('jobsList').classList.add('hidden'); }
            const userSearch = document.getElementById('searchInput').value;
            const queries = userSearch ? [userSearch + ' Agartala Tripura'] : searchQueries;
            let apiJobs = [], completed = 0;
            const results = await Promise.all(queries.map(async (q, i) => {
                try { await new Promise(r => setTimeout(r, i * 100)); const res = await fetch(`https://jsearch.p.rapidapi.com/search?query=${encodeURIComponent(q)}&num=15&page=1&country=in`, { headers: { 'X-RapidAPI-Key': API_KEY, 'X-RapidAPI-Host': 'jsearch.p.rapidapi.com' } }); const d = await res.json(); completed++; document.getElementById('loadingText').textContent = `Fetching... (${completed}/${queries.length})`; return (d.data || []).map(j => ({ id: 'api-' + j.job_id + Math.random().toString(36).substr(2,5), title: j.job_title || 'Job', company: j.employer_name || 'Company', location: j.job_city ? `${j.job_city}, Tripura` : 'Agartala', salary: j.job_min_salary ? `â‚¹${j.job_min_salary?.toLocaleString()}+` : 'As per industry', category: (j.employer_name||'').toLowerCase().includes('bank') ? 'bank' : (j.job_title||'').toLowerCase().includes('fresher') ? 'fresher' : 'private', description: (j.job_description||'').substring(0,200), requirements: [], posted: formatDate(j.job_posted_at_datetime_utc), deadline: 'Apply Soon', url: j.job_apply_link || '#', match: Math.min(50 + (j.job_city?.toLowerCase().includes('agartala') ? 20 : 0) + ((j.job_title||'').toLowerCase().includes('clerk') || (j.job_title||'').toLowerCase().includes('assistant') ? 15 : 0), 95), isNew: isRecent(j.job_posted_at_datetime_utc) })); } catch (e) { return []; }
            }));
            apiJobs = results.flat();
            allJobs = [...localJobs, ...apiJobs];
            const seen = new Set();
            allJobs = allJobs.filter(j => { const k = (j.title + j.company).toLowerCase().replace(/\s/g, ''); if (seen.has(k)) return false; seen.add(k); return true; });
            allJobs.sort((a, b) => { if (a.isNew && !b.isNew) return -1; if (!a.isNew && b.isNew) return 1; return b.match - a.match; });
            if (isAuto && allJobs.length > previousJobCount) { const diff = allJobs.length - previousJobCount; showNewJobsAlert(diff); sendNewJobsNotification(diff); }
            filterCategory(currentCategory);
            document.getElementById('loadingState').classList.add('hidden'); document.getElementById('jobsList').classList.remove('hidden');
            updateStats(); updateLastUpdate();
            if (!isAuto) showToast(`${allJobs.length} jobs found!`);
        }

        function showNewJobsAlert(c) { document.getElementById('newJobsBadge').textContent = `+${c} new`; document.getElementById('newJobsBadge').classList.remove('hidden'); document.getElementById('newJobToastCount').textContent = `${c} new jobs`; document.getElementById('newJobToast').classList.remove('hidden'); setTimeout(() => document.getElementById('newJobToast').classList.add('hidden'), 5000); }
        function updateLastUpdate() { document.getElementById('lastUpdate').textContent = `Updated: ${new Date().toLocaleTimeString()}`; }
        function formatDate(d) { if (!d) return 'Recently'; const diff = Math.floor((new Date() - new Date(d)) / 86400000); return diff <= 0 ? 'Today' : diff === 1 ? 'Yesterday' : diff < 7 ? `${diff} days ago` : `${Math.floor(diff/7)} weeks ago`; }
        function isRecent(d) { if (!d) return false; return (new Date() - new Date(d)) / 86400000 <= 3; }

        function filterCategory(cat, btn) { currentCategory = cat; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); if (btn) btn.classList.add('active'); let filtered = cat === 'saved' ? allJobs.filter(j => savedJobs.includes(j.id)) : cat === 'all' ? allJobs : allJobs.filter(j => j.category === cat); renderJobs(filtered); }
        
        function renderJobs(jobs) {
            document.getElementById('emptyState').classList.toggle('hidden', jobs.length > 0);
            document.getElementById('jobCounter').textContent = jobs.length + ' Jobs';
            const icons = {government:'ğŸ›ï¸',bank:'ğŸ¦',private:'ğŸ¢',fresher:'ğŸ“'};
            const colors = {government:'from-blue-500/20 to-blue-600/20',bank:'from-green-500/20 to-green-600/20',private:'from-purple-500/20 to-purple-600/20',fresher:'from-yellow-500/20 to-yellow-600/20'};
            document.getElementById('jobsList').innerHTML = jobs.map((j, i) => `
                <div class="glass rounded-xl p-4 job-card cursor-pointer fade-in ${j.isNew ? 'new-job' : ''}" onclick="openJobModal('${j.id}')" style="animation-delay:${i*0.03}s">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br ${colors[j.category]||'from-slate-600 to-slate-700'} flex items-center justify-center text-2xl">${icons[j.category]||'ğŸ“‹'}</div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between gap-2">
                                <div class="flex items-center gap-2"><h3 class="font-semibold truncate">${j.title}</h3>${j.isNew ? '<span class="text-xs bg-emerald-500/20 text-emerald-400 px-2 py-0.5 rounded-full">NEW</span>' : ''}</div>
                                <button onclick="event.stopPropagation();toggleSave('${j.id}')" class="text-xl">${savedJobs.includes(j.id)?'â­':'â˜†'}</button>
                            </div>
                            <p class="text-sm text-slate-400">${j.company}</p>
                            <div class="flex gap-3 text-xs text-slate-500 mt-1"><span>ğŸ“ ${j.location}</span><span>ğŸ’° ${j.salary}</span></div>
                            <div class="flex items-center justify-between mt-2"><div class="flex items-center gap-2"><div class="w-16 h-1.5 bg-slate-700 rounded-full"><div class="h-full ${j.match>=85?'bg-emerald-500':'bg-yellow-500'}" style="width:${j.match}%"></div></div><span class="text-xs ${j.match>=85?'text-emerald-400':'text-yellow-400'}">${j.match}%</span></div><span class="text-xs text-slate-500">${j.posted}</span></div>
                        </div>
                    </div>
                </div>`).join('');
        }

        function openJobModal(id) {
            const j = allJobs.find(x => x.id === id); if (!j) return;
            const icons = {government:'ğŸ›ï¸',bank:'ğŸ¦',private:'ğŸ¢',fresher:'ğŸ“'};
            document.getElementById('jobModalContent').innerHTML = `
                <div class="flex items-center justify-between mb-4"><button onclick="closeJobModal()" class="p-2 glass rounded-lg">â† Back</button><div class="flex gap-2"><button onclick="shareJob('${j.id}')" class="p-2 glass rounded-lg">ğŸ“¤</button><button onclick="toggleSave('${j.id}')" class="p-2 glass rounded-lg text-xl">${savedJobs.includes(j.id)?'â­':'â˜†'}</button></div></div>
                <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-slate-700 to-slate-800 flex items-center justify-center text-3xl mb-4">${icons[j.category]||'ğŸ“‹'}</div>
                <h2 class="text-xl font-bold">${j.title}</h2><p class="text-slate-400 mb-2">${j.company}</p>
                ${j.isNew ? '<span class="inline-block text-xs bg-emerald-500/20 text-emerald-400 px-2 py-1 rounded-full mb-3">ğŸ†• NEW</span>' : ''}
                <div class="flex items-center gap-2 mb-4"><div class="w-20 h-2 bg-slate-700 rounded-full"><div class="h-full ${j.match>=85?'bg-emerald-500':'bg-yellow-500'}" style="width:${j.match}%"></div></div><span class="text-sm ${j.match>=85?'text-emerald-400':'text-yellow-400'}">${j.match}% Match</span></div>
                <div class="grid grid-cols-2 gap-3 mb-4"><div class="glass rounded-xl p-3"><p class="text-xs text-slate-400">Location</p><p class="text-sm">${j.location}</p></div><div class="glass rounded-xl p-3"><p class="text-xs text-slate-400">Salary</p><p class="text-sm">${j.salary}</p></div><div class="glass rounded-xl p-3"><p class="text-xs text-slate-400">Posted</p><p class="text-sm">${j.posted}</p></div><div class="glass rounded-xl p-3"><p class="text-xs text-slate-400">Deadline</p><p class="text-sm text-yellow-400">${j.deadline}</p></div></div>
                <div class="mb-4"><h3 class="text-sm font-semibold mb-2">Description</h3><p class="text-sm text-slate-300">${j.description}</p></div>
                <div class="space-y-3">
                    ${appliedJobs.includes(j.id) ? '<div class="bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 text-center py-3 rounded-xl">âœ… Already Applied</div>' : `<button onclick="applyToJob('${j.id}')" class="w-full btn-primary text-white py-3 rounded-xl font-semibold">ğŸ“§ Apply via Email</button>`}
                    <button onclick="sendToTelegram('${j.id}')" class="w-full btn-telegram text-white py-3 rounded-xl">ğŸ“¨ Send to Telegram</button>
                    ${j.url !== '#' ? `<a href="${j.url}" target="_blank" class="block w-full text-center glass py-3 rounded-xl">ğŸ”— Open Original</a>` : ''}
                </div>`;
            document.getElementById('jobModal').classList.remove('hidden');
        }
        function closeJobModal() { document.getElementById('jobModal').classList.add('hidden'); }

        function toggleSave(id) { if (savedJobs.includes(id)) { savedJobs = savedJobs.filter(x => x !== id); showToast('Removed'); } else { savedJobs.push(id); showToast('Saved!'); } localStorage.setItem('jobbot_saved', JSON.stringify(savedJobs)); filterCategory(currentCategory); updateStats(); }
        function applyToJob(id) { const j = allJobs.find(x => x.id === id); if (!j) return; if (!appliedJobs.includes(id)) { appliedJobs.push(id); localStorage.setItem('jobbot_applied', JSON.stringify(appliedJobs)); updateStats(); } const sub = encodeURIComponent(`Application for ${j.title}`), body = encodeURIComponent(`Dear Hiring Manager,\n\nI am applying for ${j.title} at ${j.company}.\n\nName: ${userProfile.name||''}\nEmail: ${userProfile.email||''}\nPhone: ${userProfile.phone||''}\n\nThank you!`); window.open(`mailto:?subject=${sub}&body=${body}`); showToast('Opening email...'); }
        function shareJob(id) { const j = allJobs.find(x => x.id === id); if (!j) return; const t = `${j.title}\n${j.company}, ${j.location}\n${j.salary}\n${j.url||''}`; if (navigator.share) navigator.share({ title: j.title, text: t }); else { navigator.clipboard.writeText(t); showToast('Copied!'); } }
        async function sendToTelegram(id) { const j = allJobs.find(x => x.id === id); if (!j) return; const t = userProfile.telegramToken, c = userProfile.telegramChatId; if (!t || !c) { showToast('Setup Telegram in Settings'); closeJobModal(); openSettings(); return; } try { const r = await fetch(`https://api.telegram.org/bot${t}/sendMessage`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ chat_id: c, text: `ğŸŒŸ ${j.title}\nğŸ“ ${j.company}, ${j.location}\nğŸ’° ${j.salary}\n\n${j.url||'Apply now!'}`, parse_mode: 'Markdown' }) }); const d = await r.json(); showToast(d.ok ? 'Sent!' : 'Error: ' + d.description); } catch (e) { showToast('Failed'); } }

        function openSettings() { document.getElementById('settingsModal').classList.remove('hidden'); }
        function closeSettings() { document.getElementById('settingsModal').classList.add('hidden'); }
        function loadSettingsToForm() { document.getElementById('settingsName').value = userProfile.name || ''; document.getElementById('settingsEmail').value = userProfile.email || ''; document.getElementById('settingsPhone').value = userProfile.phone || ''; document.getElementById('settingsJobTitle').value = userProfile.jobTitle || ''; document.getElementById('settingsSkills').value = userProfile.skills || ''; document.getElementById('settingsTelegramToken').value = userProfile.telegramToken || ''; document.getElementById('settingsTelegramChatId').value = userProfile.telegramChatId || ''; }
        function loadSavedSettings() { document.getElementById('updateInterval').value = settings.interval || 5; }
        function saveSettings() { userProfile = { name: document.getElementById('settingsName').value, email: document.getElementById('settingsEmail').value, phone: document.getElementById('settingsPhone').value, jobTitle: document.getElementById('settingsJobTitle').value, skills: document.getElementById('settingsSkills').value, telegramToken: document.getElementById('settingsTelegramToken').value, telegramChatId: document.getElementById('settingsTelegramChatId').value }; localStorage.setItem('jobbot_profile', JSON.stringify(userProfile)); showToast('Saved!'); closeSettings(); refreshJobs(); }
        async function testTelegram() { const t = document.getElementById('settingsTelegramToken').value, c = document.getElementById('settingsTelegramChatId').value; if (!t || !c) { showToast('Enter Token & Chat ID'); return; } try { const r = await fetch(`https://api.telegram.org/bot${t}/sendMessage`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ chat_id: c, text: 'âœ… JobBot Pro Connected!\n\nYou will receive Agartala job alerts here!', parse_mode: 'Markdown' }) }); const d = await r.json(); showToast(d.ok ? 'Check Telegram!' : 'Error: ' + d.description); } catch (e) { showToast('Failed'); } }

        function updateStats() { document.getElementById('statTotal').textContent = allJobs.length; document.getElementById('statNew').textContent = allJobs.filter(j => j.isNew).length; document.getElementById('statSaved').textContent = savedJobs.length; document.getElementById('statMatch').textContent = allJobs.filter(j => j.match >= 85).length; document.getElementById('statApplied').textContent = appliedJobs.length; }
        function showToast(m) { document.getElementById('toastMessage').textContent = m; document.getElementById('toast').classList.remove('hidden'); setTimeout(() => document.getElementById('toast').classList.add('hidden'), 3000); }
    </script>
</body>
</html>
